---
title: Redis面试题
date: 2024-04-12 02:10:09
permalink: /pages/e239a6/
---
## 数据持久化策略都有哪些

1. RDB：将数据写入到磁盘中，重启Redis后会从磁盘中读取数据
2. AOF：记录每一条执行的Redis命令，有点类似日志的效果，当Redis重启后会重新载入命令恢复数据

RDB产生的备份文件会进行压缩处理，效率较高但数据完整性不如AOF，AOF数据完整性高但数据文件相对也比较大效率不如RDB



## 什么是缓存穿透，怎么解决

频繁查询一个不存在的数据，数据库中查询不到结果也就无法缓存这条数据，这样一来该数据的所有查询请求都会走数据库造成性能消耗，大概率是恶意请求或非法请求

针对缓存穿透有两种解决方案：

1. 缓存空数据，如果数据库中没有查询出对应数据，那么将null为结果缓存到redis中，后续查询会在redis中查询查询出null并返回
2. 使用布隆过滤器，在查询请求到达redis之前先经过布隆过滤器，判断该数据是否存在，存在继续执行，不存在直接返回null



## 什么是缓存击穿，怎么解决

当Redis中某个KEY过期后，在缓存重建完成之前的间隙，大量请求涌入直接查询数据库造成性能消耗

针对缓存击穿有两种解决方案：

1. 使用分布式锁，当首个请求没有读取到指定KEY后会获取锁，然后查询数据库并缓存数据，在这期间其他请求如果没有读取到指定KEY同样会获取锁，但是锁并没有被释放所以请求不会继续往下走，等到缓存重建完成后才会继续执行
2. 使用逻辑过期：缓存击穿常见于KEY过期重建流程，既然该流程有问题就把KEY设置为永不过期，然后在Value中新增一个字段为逻辑过期，当读取到数据后在代码中判断数据是否过期，如果数据已过期就获取锁，然后新开线程去做缓存重建以及锁的释放，自己直接返回旧的数据，其他请求继续执行，等新线程执行结束数据自然会更新




## 什么是缓存雪崩，怎么解决

短时间内Redis中大量的KEY过期，导致某个时间段内大量请求直接堆到数据库造成性能消耗，针对这点可以在设置缓存过期时间时，在原本的过期时间基础上加个随机值




## 如何保证Redis和数据库保持一致

1. 在数据一致性要求不是很强的情况下可以使用延迟双删的方案，接收到更新操作后先删除Redis中的KEY，紧接着更新数据库后稍微等一下在删除一次KEY，保证数据一致性
2. 如果要求数据强一致性，那么可以采用读写锁的方式来实现



## 分布式锁如何实现

分布式锁用到的是Redis提供的setnx命令，向Redis中设置一个KEY同时设置过期时间，设置成功就代表获取到了锁，业务执行完成后删除KEY代表释放锁，一般使用Redisson框架来实现这个功能



## 分布式锁的有效时长是怎么控制的

按照业务逻辑推演耗时，并在其基础上适当增加一小段时间，原因如下：

1. 因为业务执行后会手动删除该KEY所以时长稍微长一点并没有影响
2. Redisson在获取锁后会单起一个看门狗线程定期为KEY进行续时，防止锁过期后业务还没有执行完，适当增加过期时间可以减少续时次数节约性能
3. 就算微服务宕机，稍微加长一小段时间也无伤大雅，锁还是会自动过期



## Redisson是可重入锁吗

Redission是可重入锁，当同一个线程第二次获取该锁时会检查之前获取锁的是不是该线程，Redission为锁维护了一个标志位，如果是同一个线程多次获取锁会将标志位+1，同样的释放锁会-1




## Redisson是公平锁吗

Redission默认是非公平锁，但是他支持公平锁，可以在获取锁的时候可以选择获取公平锁即可