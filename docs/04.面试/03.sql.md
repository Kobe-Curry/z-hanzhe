---
title: SQL面试题
date: 2024-03-11 13:53:00
permalink: /pages/82c76d/
---


## 你是如何进行SQL优化的

1. 首先修改MySQL的配置文件，开启**慢SQL日志**记录，定位到执行速度慢的SQL，然后分析SQL看看是那几张表关联，分析表结构和索引建立情况
2. 定位到SQL并了解表结构后可以使用`explain`关键字查看SQL执行计划，观察索引是否生效，是否需要调整或者新建索引
3. 看看SQL中是否使用了破坏索引的写法，避免使用`SELECT *`查询，避免在条件中进行运算，like查询和联合索引应当遵循最左规则，分组查询时能在where中过滤的不要放到having
4. 可参考该文章 https://www.sohu.com/a/727441376_121124376



## 关联查询特点是什么

1. inner join 内连接，两张表都不为空可以查出结果
2. left join 左连接，以左侧表为基准，右侧表无结果为null
3. right join 右连接，以右侧表为基准，左侧表无结果为null



## 查询条件中包含%怎么处理

可以通过注解配合AOP切面进行处理，将入参的`%`统一批量替换为转义后的`\%`



## 事务四大特性ACID

1. 原子性（Atomic）：事务中可能包含多条SQL语句，这些SQL语句要么全部执行成功，要么全部执行失败
2. 一致性（Consistency）：例如A和B两个用户转账，无论怎么转账他俩的余额加起来的值是不变的
3. 隔离性（Isolation）：数据库提供了事务隔离机制，用来应对并发场景下多个事务操作同一张表的问题
4. 持久性（Durability）：事务提交后会永久写入到数据库中



## 事务隔离级别

并发事务可能会出现的问题：

1. 脏读：指某个事务读取到了另一个事务还没有提交的数据，读取到了脏数据
2. 不可重复读：一个事务先后读取同一条数据，但先后读取到的内容不同
3. 幻读：查询某条数据时发现数据不存在，然后执行插入时又发现数据已经存在了，好像出现了幻觉

隔离级别是用来应对并发事务问题的，有四种事务隔离级别：

| 隔离级别                              | 脏读 | 不可重复读 | 幻读 |
| :------------------------------------ | :--- | ---------- | ---- |
| 读未提交 Read uncommitted             | ⚠️    | ⚠️          | ⚠️    |
| 读已提交 Read committed（Oracle默认） | ✅    | ⚠️          | ⚠️    |
| 可重复读 Repeatable Read（MySQL默认） | ✅    | ✅          | ⚠️    |
| 串行化 Serializable                   | ✅    | ✅          | ✅    |



## 索引都有哪些

1. 主键索引 primary：唯一主键就是索引，根据主键进行查询效率最高，主键索引只能有一个
2. 唯一索引 unique：保证当前行的数据在整张表中不会重复，可以创建唯一索引，除开主键索引之外效率最高
3. 常规索引 normal：表中一些关键性的常用于检索的字段可创建普通索引，例如手机号身份证号
4. 全文索引 fulltext：适用于文章内关键字检索



## 什么是聚集和二级索引

聚集索引代表主键和行数据存在一起，默认主键索引聚集索引，如果表中没有主键则会使用第一个唯一索引，如果两个都没有那么数据库底层会维护隐式的聚集索引，聚集索引只能有一个



## 索引失效的情况

1. 在索引列上进行运算操作，例如加减乘除以及函数运算
2. 模糊查询情况下，开头使用通配符`_` `%`会破坏索引
4. or关键字拼接的条件中，任意一个列没有建立索引，那么该or涉及到的所有列索引全都失效
5. 如果经过MySQL评估后觉得全表扫描比走索引效率更高，那么就不会使用索引



## 什么是回表查询，怎么优化

聚集索引会存储主键以及行数据，二级索引会存储自己本身以及主键，当根据二级索引查询到主键值后，会根据走聚集索引根据主键值查询整行数据，这种两次查询的过程被称为回表查询



## explain主要有哪些列

| 列           | 作用                                                         |
| ------------ | ------------------------------------------------------------ |
| id           | 查询顺序，数字越大越先执行，数字相同则上面的先执行，为空则最后执行 |
| select_type  | 查询类型，例如 simple 简单查询，primary 主查询，subquery 子查询，union 查询等等 |
| table        | 查询的表名，                                                 |
| type         | 连接类型，性能由高到低大致分为 NULL，system，const，eq_ref，ref，range，index，ALL |
| possible_key | 当前查询这张表中可能会用到的索引                             |
| key          | 查询中实际用到的索引                                         |
| key_len      | 使用到的索引长度                                             |
| rows         | MySQL语句可能需要查询的行数                                  |
| filtered     | 实际查询到的行数占 rows 的百分比，这个值越大越好             |
| Extra        | 其他的额外内容                                               |

